<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Tehilim de Maman</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Police Noto Serif & Sans -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans', sans-serif; }
        .font-serif { font-family: 'Noto Serif', serif; }
    </style>

    <!-- Import Map pour g√©rer les biblioth√®ques sans installation -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
        }
    }
    </script>

    <!-- Babel pour comprendre le code React -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Settings, Plus, Trash2, Edit2, Save, X, BookOpen, Heart, ArrowLeft, Loader2, Check, CheckCircle, RefreshCw, LogIn, Download, LogOut } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { 
            getAuth, 
            onAuthStateChanged, 
            GoogleAuthProvider, 
            signInWithPopup, 
            signOut 
        } from 'firebase/auth';
        import { 
            getFirestore, 
            collection, 
            doc, 
            addDoc, 
            updateDoc, 
            deleteDoc, 
            onSnapshot, 
            setDoc,
            writeBatch
        } from 'firebase/firestore';

        // Donn√©es initiales pour la restauration
        const INITIAL_DATA = [
            { name: "Sheina bat Aziza Sara", hebrewDate: "8 Tichri", birthDate: "2025-10-01", gender: "girl" },
            { name: "Zvi Ben Preciada L√©a", hebrewDate: "5 Tamouz", birthDate: "2025-07-01", gender: "boy" },
            { name: "Yeshua Nahman Ben Haya Moushka", hebrewDate: "19 Adar", birthDate: "2025-03-19", gender: "boy" },
            { name: "Israel Ben Dvorah L√©a", hebrewDate: "23 Tichri", birthDate: "2024-10-25", gender: "boy" },
            { name: "Shterna Sara Bat Preciada L√©a", hebrewDate: "10 Av", birthDate: "2024-08-14", gender: "girl" },
            { name: "Orah Aliza Bat Odel Aidel", hebrewDate: "30 Shevat", birthDate: "2024-02-09", gender: "girl" },
            { name: "Haya Moushka Bat Preciada L√©a", hebrewDate: "17 Tamouz", birthDate: "2023-07-06", gender: "girl" },
            { name: "Yossef Ytshak Ben Aziza Sara", hebrewDate: "8 Shevat", birthDate: "2023-01-30", gender: "boy" },
            { name: "Levi Ytshak Ben Haya Mushka", hebrewDate: "11 Sivan", birthDate: "2022-06-10", gender: "boy" },
            { name: "Menahem Mendel Ben Dvorah L√©a", hebrewDate: "22 Kislev", birthDate: "2021-11-26", gender: "boy" },
            { name: "Shmuel Ben Aziza Sara", hebrewDate: "7 Iyar", birthDate: "2020-05-01", gender: "boy" },
            { name: "Shenr.Z Ben Odel Aidel", hebrewDate: "7 Adar", birthDate: "2020-03-03", gender: "boy" },
            { name: "Haya Mushka Bat Dvorah L√©a", hebrewDate: "24 Adar B", birthDate: "2019-03-31", gender: "girl" },
            { name: "Hinda Braha Bat Sima Golda", hebrewDate: "28 Heshvan", birthDate: "2018-11-06", gender: "girl" },
            { name: "Rivka Bat Aziza Sara", hebrewDate: "2 Kislev", birthDate: "2017-11-21", gender: "girl" },
            { name: "Yshai M.M. Ben Rina Haya Mushka", hebrewDate: "29 Ellul", birthDate: "2017-09-20", gender: "boy" },
            { name: "Sheina Preciada Bat Odel Aidel", hebrewDate: "6 Tamouz", birthDate: "2017-06-30", gender: "girl" },
            { name: "Shneior Z. Ben Dvorah L√©a", hebrewDate: "9 Ellul", birthDate: "2016-09-12", gender: "boy" },
            { name: "Tsemah David Zvi Ben Rina Haya Mushka", hebrewDate: "29 Ellul", birthDate: "2015-09-13", gender: "boy" },
            { name: "Dvorah L√©a Bat Aziza Sara", hebrewDate: "29 Sivan", birthDate: "2015-06-16", gender: "girl" },
            { name: "Shmouel Ben Dvorah L√©a", hebrewDate: "2 Adar", birthDate: "2015-02-21", gender: "boy" },
            { name: "Eythan Yehuda Ben Rina Haya Moushka", hebrewDate: "24 Kislev", birthDate: "2014-12-16", gender: "boy" },
            { name: "Haya Mushka Bat Aziza Sara", hebrewDate: "23 Kislev", birthDate: "2012-12-07", gender: "girl" }
        ];

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDl6C8AbOgnPkBhqabE3KJGmnJDQ6snXvs",
            authDomain: "mom-s-daily-tehilim.firebaseapp.com",
            projectId: "mom-s-daily-tehilim",
            storageBucket: "mom-s-daily-tehilim.firebasestorage.app",
            messagingSenderId: "440475739791",
            appId: "1:440475739791:web:de509df902068900bb72fa"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // ID de l'application (fixe pour le web)
        const appId = 'moms-tehillim-app'; 

        function TehillimApp() {
            // --- STATE ---
            const [user, setUser] = useState(null);
            const [loadingAuth, setLoadingAuth] = useState(true); // √âtat de chargement pour l'auth
            const [children, setChildren] = useState([]);
            const [completedIds, setCompletedIds] = useState([]);
            
            const [view, setView] = useState('list'); // 'list', 'settings', 'reader'
            const [readingChild, setReadingChild] = useState(null);
            const [psalmText, setPsalmText] = useState(null);
            const [loadingPsalm, setLoadingPsalm] = useState(false);
            const [todayHebrew, setTodayHebrew] = useState("");
            
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                hebrewDate: '',
                birthDate: '',
                gender: 'girl'
            });

            // --- INITIALIZATION ---

            useEffect(() => {
                // On √©coute simplement l'√©tat de l'authentification
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    setLoadingAuth(false);
                });

                // Date H√©bra√Øque
                try {
                    const date = new Date();
                    const formatter = new Intl.DateTimeFormat('fr-FR-u-ca-hebrew', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                    setTodayHebrew(formatter.format(date));
                } catch (e) {
                    setTodayHebrew("Date non disponible");
                }

                return () => unsubscribe();
            }, []);

            // --- FIRESTORE LISTENERS ---

            useEffect(() => {
                if (!user) return;

                // A. Listen to Children List
                const childrenRef = collection(db, 'artifacts', appId, 'users', user.uid, 'children');
                const unsubscribeChildren = onSnapshot(childrenRef, (snapshot) => {
                    const kids = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setChildren(kids);
                }, (error) => {
                    console.error("Error fetching children:", error);
                    if (error.code === 'permission-denied') {
                         console.warn("Permission denied. Database rules likely need updating.");
                    }
                });

                // B. Listen to Completed Status
                const todayStr = new Date().toDateString();
                const completedRef = doc(db, 'artifacts', appId, 'users', user.uid, 'completed', todayStr);
                
                const unsubscribeCompleted = onSnapshot(completedRef, (docSnap) => {
                    if (docSnap.exists()) {
                        setCompletedIds(docSnap.data().ids || []);
                    } else {
                        setCompletedIds([]);
                    }
                }, (error) => console.error("Error fetching completion:", error));

                return () => {
                    unsubscribeChildren();
                    unsubscribeCompleted();
                };
            }, [user]);

            // --- ACTIONS ---

            const handleGoogleLogin = async () => {
                try {
                    const provider = new GoogleAuthProvider();
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Login failed", error);
                    alert("Erreur de connexion Google: " + error.message);
                }
            };

            const handleLogout = async () => {
                await signOut(auth);
                // Le listener onAuthStateChanged s'occupera de mettre user √† null
            };

            const calculateChapter = (birthDateString) => {
                const birthDate = new Date(birthDateString);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age + 1;
            };

            const cleanText = (text, isHebrew = false) => {
                if (!text) return "";
                let cleaned = text
                    .replace(/<[^>]+>/g, '') 
                    .replace(/&[a-z0-9#]+;/gi, '') 
                    .replace(/\{[^}]+\}/g, '') 
                    .replace(/\[[^\]]+\]/g, '') 
                    .replace(/◊Ä/g, '') 
                    .trim();
                if (isHebrew) {
                    cleaned = cleaned.replace(/[a-zA-Z]/g, '');
                }
                return cleaned;
            };

            const markAsDone = async (childId) => {
                if (!user) return;
                if (completedIds.includes(childId)) return;

                const todayStr = new Date().toDateString();
                const completedRef = doc(db, 'artifacts', appId, 'users', user.uid, 'completed', todayStr);
                
                const newIds = [...completedIds, childId];
                setCompletedIds(newIds);

                try {
                    await setDoc(completedRef, { ids: newIds, date: todayStr }, { merge: true });
                } catch (e) {
                    console.error("Error saving completion", e);
                }
            };

            const handleDownloadBackup = () => {
                if (children.length === 0) {
                    alert("La liste est vide, rien √† sauvegarder.");
                    return;
                }
                const jsonString = JSON.stringify(children, null, 2);
                const blob = new Blob([jsonString], { type: "application/json" });
                const href = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = href;
                link.download = `tehillim_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(href);
            };

            const restoreDefaults = async () => {
                if (!user) return;
                if (!window.confirm("Cela va ajouter toute la liste par d√©faut. Continuer ?")) return;

                const batch = writeBatch(db);
                const childrenRef = collection(db, 'artifacts', appId, 'users', user.uid, 'children');

                INITIAL_DATA.forEach(child => {
                    const newDocRef = doc(childrenRef);
                    batch.set(newDocRef, child);
                });

                try {
                    await batch.commit();
                    alert("Liste restaur√©e avec succ√®s !");
                } catch (error) {
                    console.error("Erreur lors de la restauration:", error);
                    if (error.code === 'permission-denied') {
                        alert("üîí ERREUR PERMISSION : Les r√®gles de s√©curit√© Firebase bloquent l'√©criture. Allez dans Console Firebase > Firestore Database > Rules et collez les r√®gles fournies.");
                    } else {
                        alert("Erreur lors de la sauvegarde : " + error.message);
                    }
                }
            };

            const handleSave = async (e) => {
                e.preventDefault();
                if (!user) return;

                try {
                    if (editingId) {
                        const childRef = doc(db, 'artifacts', appId, 'users', user.uid, 'children', editingId);
                        await updateDoc(childRef, formData);
                        setEditingId(null);
                    } else {
                        const childrenRef = collection(db, 'artifacts', appId, 'users', user.uid, 'children');
                        await addDoc(childrenRef, formData);
                    }
                    setFormData({ name: '', hebrewDate: '', birthDate: '', gender: 'girl' });
                } catch (error) {
                    console.error("Error saving child:", error);
                    if (error.code === 'permission-denied') {
                        alert("üîí ERREUR PERMISSION : Les r√®gles de s√©curit√© Firebase bloquent l'√©criture. V√©rifiez l'onglet 'Rules' dans Firestore.");
                    } else {
                        alert("Erreur de sauvegarde: " + error.message);
                    }
                }
            };

            const deleteChild = async (id) => {
                if (!user) return;
                if (window.confirm('Voulez-vous vraiment supprimer cet enfant de la liste ?')) {
                    try {
                        const childRef = doc(db, 'artifacts', appId, 'users', user.uid, 'children', id);
                        await deleteDoc(childRef);
                    } catch (e) {
                        console.error("Error deleting", e);
                        if (e.code === 'permission-denied') {
                            alert("üîí Permission refus√©e.");
                        }
                    }
                }
            };

            const openReader = async (child) => {
                setReadingChild(child);
                setView('reader');
                setLoadingPsalm(true);
                setPsalmText(null);
                const chapter = calculateChapter(child.birthDate);
                try {
                    const response = await fetch(`https://www.sefaria.org/api/texts/Psalms.${chapter}?context=0`);
                    const data = await response.json();
                    setPsalmText(data);
                } catch (error) {
                    console.error("Error fetching Psalm", error);
                } finally {
                    setLoadingPsalm(false);
                }
            };

            const closeReader = (markDone = false) => {
                if (markDone && readingChild) {
                    markAsDone(readingChild.id);
                }
                setView('list');
                setReadingChild(null);
                setPsalmText(null);
            };

            const startEdit = (child) => {
                setFormData(child);
                setEditingId(child.id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const sortedChildren = [...children].sort((a, b) => 
                new Date(b.birthDate) - new Date(a.birthDate)
            );

            // --- RENDERING AUTH GATE ---

            if (loadingAuth) {
                return (
                    <div className="min-h-screen bg-slate-50 flex items-center justify-center">
                         <Loader2 className="animate-spin text-slate-400" size={32} />
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4">
                        <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-100 max-w-sm w-full text-center">
                            <h1 className="text-2xl font-bold text-slate-800 font-serif mb-2">
                                ◊ê◊ú ◊î◊†◊¢◊® ◊î◊ñ◊î ◊î◊™◊§◊ú◊ú◊™◊ô
                            </h1>
                            <p className="text-slate-500 mb-8 uppercase tracking-widest text-xs">
                                Les Tehilim de Maman
                            </p>
                            
                            <div className="mb-6">
                                <span className="inline-block p-4 rounded-full bg-blue-50 text-blue-500 mb-2">
                                    <BookOpen size={32} />
                                </span>
                                <p className="text-sm text-slate-600">
                                    Connectez-vous pour acc√©der √† votre liste de pri√®res.
                                </p>
                            </div>

                            <button 
                                onClick={handleGoogleLogin}
                                className="w-full bg-blue-600 text-white px-4 py-3 rounded-xl font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 shadow-sm shadow-blue-200"
                            >
                                <LogIn size={20} />
                                Se connecter avec Google
                            </button>
                        </div>
                    </div>
                );
            }

            // --- MAIN APP VIEWS (Authenticated) ---

            if (view === 'reader' && readingChild) {
                const chapter = calculateChapter(readingChild.birthDate);
                const isBoy = readingChild.gender === 'boy';
                const accentColor = isBoy ? 'text-blue-600' : 'text-pink-600';
                const bgAccent = isBoy ? 'bg-blue-50' : 'bg-pink-50';

                return (
                    <div className="min-h-screen bg-white flex flex-col">
                        <header className="bg-white border-b border-slate-100 sticky top-0 z-20 px-4 py-3 flex items-center justify-between shadow-sm">
                            <button onClick={() => closeReader(false)} className="flex items-center gap-1 text-slate-600 font-medium">
                                <ArrowLeft size={20} />
                                Retour
                            </button>
                            <div className="text-center">
                                <span className={`text-xs font-bold uppercase tracking-wider ${accentColor}`}>
                                    Psaume {chapter}
                                </span>
                                <p className="text-sm font-semibold text-slate-800 truncate max-w-[150px]">
                                    {readingChild.name}
                                </p>
                            </div>
                            <div className="w-8"></div>
                        </header>

                        <main className="flex-1 p-6 max-w-2xl mx-auto w-full">
                            {loadingPsalm ? (
                                <div className="flex flex-col items-center justify-center h-64 gap-3 text-slate-400">
                                    <Loader2 className="animate-spin" size={32} />
                                    <p>Chargement du Psaume...</p>
                                </div>
                            ) : psalmText ? (
                                <div className="animate-in fade-in slide-in-from-bottom-2 duration-500 pb-12">
                                    <div className="text-right font-serif text-2xl leading-loose text-slate-900 mb-8" dir="rtl">
                                        {psalmText.he.map((verse, index) => (
                                            <span key={index}>
                                                <span className="text-xs text-slate-400 align-top ml-1 select-none">
                                                    ({index + 1})
                                                </span>
                                                {cleanText(verse, true)}{" "}
                                            </span>
                                        ))}
                                    </div>

                                    <div className="h-px bg-slate-100 my-8 mx-10"></div>

                                    <div className="text-left font-serif text-lg leading-relaxed text-slate-600">
                                        {psalmText.text.map((verse, index) => (
                                            <p key={index} className="mb-2">
                                                <sup className="text-xs text-slate-400 mr-2">{index + 1}</sup>
                                                {cleanText(verse, false)}
                                            </p>
                                        ))}
                                    </div>
                                    
                                    <div className="mt-12 sticky bottom-6">
                                        <button 
                                            onClick={() => closeReader(true)}
                                            className="w-full bg-green-600 text-white shadow-lg shadow-green-200 font-bold text-lg py-4 rounded-xl flex items-center justify-center gap-2 hover:bg-green-700 transition-all active:scale-95"
                                        >
                                            <CheckCircle size={24} />
                                            J'ai termin√© la lecture
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center py-10 text-red-400">
                                    <p>Impossible de charger le texte.</p>
                                    <p className="text-sm text-slate-500">V√©rifiez votre connexion internet.</p>
                                </div>
                            )}
                        </main>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 pb-20 font-sans">
                    <header className="bg-white shadow-sm sticky top-0 z-10 border-b border-slate-200">
                        <div className="bg-slate-50 py-1 px-4 flex justify-between items-center border-b border-slate-100">
                            <p className="text-xs text-slate-500 font-medium font-serif">
                                {todayHebrew || "Chargement..."}
                            </p>
                            <div className="flex items-center gap-2">
                                <p className="text-[10px] text-green-600 flex items-center gap-1 font-medium">
                                    <span className="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                    {user.email}
                                </p>
                                <button onClick={handleLogout} title="D√©connexion" className="text-slate-400 hover:text-red-500">
                                    <LogOut size={12} />
                                </button>
                            </div>
                        </div>
                        <div className="max-w-md mx-auto px-4 py-4 flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold text-slate-800 text-center font-serif leading-tight">
                                    ◊ê◊ú ◊î◊†◊¢◊® ◊î◊ñ◊î ◊î◊™◊§◊ú◊ú◊™◊ô
                                </h1>
                                <p className="text-xs text-slate-500 text-center uppercase tracking-widest mt-1">
                                    Les Tehilim de Maman
                                </p>
                                {view === 'list' && (
                                    <p className="text-xs text-green-600 font-medium text-center uppercase tracking-widest mt-1 flex items-center gap-1 justify-center">
                                        <CheckCircle size={10} />
                                        {completedIds.length} / {sortedChildren.length || 1} Termin√©s
                                    </p>
                                )}
                            </div>
                            <div className="flex items-center gap-2">
                                {view === 'list' && (
                                    <button 
                                        onClick={handleDownloadBackup}
                                        className="p-2 bg-slate-100 rounded-full hover:bg-slate-200 transition-colors"
                                        title="Sauvegarder sur le t√©l√©phone"
                                    >
                                        <Download size={20} className="text-slate-600" />
                                    </button>
                                )}
                                <button 
                                    onClick={() => setView(view === 'list' ? 'settings' : 'list')}
                                    className="p-2 bg-slate-100 rounded-full hover:bg-slate-200 transition-colors"
                                >
                                    {view === 'list' ? <Settings size={20} className="text-slate-600" /> : <X size={20} className="text-slate-600" />}
                                </button>
                            </div>
                        </div>
                        {view === 'list' && sortedChildren.length > 0 && (
                            <div className="h-1 bg-slate-100 w-full">
                                <div 
                                    className="h-full bg-green-500 transition-all duration-500 ease-out"
                                    style={{ width: `${(completedIds.length / sortedChildren.length) * 100}%` }}
                                ></div>
                            </div>
                        )}
                    </header>

                    <main className="max-w-md mx-auto p-4">
                        {view === 'list' ? (
                            <div className="space-y-4">
                                {sortedChildren.map((child) => {
                                    const chapter = calculateChapter(child.birthDate);
                                    const isBoy = child.gender === 'boy';
                                    const isDone = completedIds.includes(child.id);
                                    
                                    return (
                                        <div 
                                            key={child.id} 
                                            className={`rounded-2xl shadow-sm border overflow-hidden relative transition-all duration-300 ${
                                                isDone ? 'bg-green-50/50 border-green-200' : 'bg-white border-slate-100'
                                            }`}
                                        >
                                            <div className={`absolute left-0 top-0 bottom-0 w-1.5 ${isBoy ? 'bg-blue-400' : 'bg-pink-400'} ${isDone ? 'opacity-50' : ''}`}></div>
                                            
                                            <div className="p-5 pl-7">
                                                <div className="flex justify-between items-start">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <Heart 
                                                                size={16} 
                                                                className={`${isBoy ? 'text-blue-500 fill-blue-500' : 'text-pink-500 fill-pink-500'}`} 
                                                            />
                                                            <span className="text-xs font-semibold text-slate-400 uppercase tracking-wider">
                                                                {child.hebrewDate}
                                                            </span>
                                                        </div>
                                                        <h2 className={`text-lg font-bold leading-snug mb-2 flex items-center gap-2 ${isDone ? 'text-green-800' : 'text-slate-800'}`}>
                                                            {child.name}
                                                            {isDone && <CheckCircle size={18} className="text-green-500 fill-green-100" />}
                                                        </h2>
                                                    </div>
                                                    
                                                    <div className={`flex flex-col items-center justify-center rounded-xl p-3 border min-w-[80px] ${isDone ? 'bg-green-100 border-green-200' : 'bg-slate-50 border-slate-100'}`}>
                                                        <span className={`text-xs font-medium ${isDone ? 'text-green-600' : 'text-slate-400'}`}>Psaume</span>
                                                        <span className={`text-3xl font-bold ${isDone ? 'text-green-700' : 'text-slate-700'}`}>{chapter}</span>
                                                    </div>
                                                </div>

                                                <div className={`mt-4 pt-3 border-t flex justify-end ${isDone ? 'border-green-100' : 'border-slate-50'}`}>
                                                    <button 
                                                        onClick={() => openReader(child)}
                                                        className={`flex items-center gap-2 text-sm font-medium px-4 py-2 rounded-lg transition-colors w-full justify-center ${
                                                            isDone 
                                                            ? 'bg-green-100 text-green-700 hover:bg-green-200' 
                                                            : (isBoy ? 'bg-blue-50 text-blue-700 hover:bg-blue-100' : 'bg-pink-50 text-pink-700 hover:bg-pink-100')
                                                        }`}
                                                    >
                                                        {isDone ? <Check size={16} /> : <BookOpen size={16} />}
                                                        {isDone ? `Relire Psaume ${chapter}` : `Lire le Psaume ${chapter}`}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                                
                                {sortedChildren.length === 0 && (
                                    <div className="text-center py-10 text-slate-400">
                                        <p>Votre liste est vide.</p>
                                        <p className="text-sm">Allez dans les param√®tres pour restaurer la liste par d√©faut ou ajouter des enfants.</p>
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-300">
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-5 mb-6">
                                    <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                        <Settings size={18} />
                                        Compte
                                    </h2>
                                    <div className="bg-green-50 border border-green-100 rounded-lg p-4 flex items-center justify-between">
                                        <div className="text-sm text-green-800">
                                            <p className="font-bold">Connect√© avec Google</p>
                                            <p>{user.email}</p>
                                        </div>
                                    </div>
                                    
                                    {children.length === 0 && (
                                        <button 
                                            type="button"
                                            onClick={restoreDefaults}
                                            className="w-full mt-4 bg-slate-100 text-slate-600 px-4 py-2 rounded-lg font-medium hover:bg-slate-200 flex items-center justify-center gap-2"
                                        >
                                            <RefreshCw size={16} />
                                            Restaurer la liste par d√©faut
                                        </button>
                                    )}
                                </div>

                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-5 mb-6">
                                    <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                        {editingId ? <Edit2 size={18} /> : <Plus size={18} />}
                                        {editingId ? 'Modifier' : 'Ajouter un enfant'}
                                    </h2>
                                    
                                    <form onSubmit={handleSave} className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-600 mb-1">Nom complet</label>
                                            <input
                                                required
                                                type="text"
                                                value={formData.name}
                                                onChange={e => setFormData({...formData, name: e.target.value})}
                                                placeholder="Ex: Sheina bat Aziza Sara"
                                                className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-slate-600 mb-1">Date H√©bra√Øque</label>
                                                <input
                                                    type="text"
                                                    value={formData.hebrewDate}
                                                    onChange={e => setFormData({...formData, hebrewDate: e.target.value})}
                                                    placeholder="Ex: 8 Tichri"
                                                    className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-slate-600 mb-1">Genre</label>
                                                <select
                                                    value={formData.gender}
                                                    onChange={e => setFormData({...formData, gender: e.target.value})}
                                                    className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                >
                                                    <option value="girl">Fille (‚ù§Ô∏è)</option>
                                                    <option value="boy">Gar√ßon (üíô)</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-600 mb-1">
                                                Date de naissance (pour le calcul)
                                            </label>
                                            <input
                                                required
                                                type="date"
                                                value={formData.birthDate}
                                                onChange={e => setFormData({...formData, birthDate: e.target.value})}
                                                className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                            <p className="text-xs text-slate-400 mt-1">Utilis√©e pour calculer l'√¢ge automatiquement.</p>
                                        </div>

                                        <div className="flex gap-2 pt-2">
                                            {editingId && (
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        setEditingId(null);
                                                        setFormData({ name: '', hebrewDate: '', birthDate: '', gender: 'girl' });
                                                    }}
                                                    className="px-4 py-3 rounded-lg border border-slate-200 text-slate-600 font-medium flex-1"
                                                >
                                                    Annuler
                                                </button>
                                            )}
                                            <button
                                                type="submit"
                                                className="bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 flex-1 flex items-center justify-center gap-2"
                                            >
                                                <Save size={18} />
                                                {editingId ? 'Mettre √† jour' : 'Enregistrer'}
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <div className="space-y-3">
                                    <h3 className="font-semibold text-slate-500 text-sm uppercase tracking-wider mb-2">G√©rer la liste ({sortedChildren.length})</h3>
                                    {sortedChildren.map((child) => (
                                        <div key={child.id} className="flex items-center justify-between p-3 bg-white border border-slate-100 rounded-lg">
                                            <div className="flex items-center gap-3 overflow-hidden">
                                                <div className={`w-2 h-8 rounded-full ${child.gender === 'boy' ? 'bg-blue-400' : 'bg-pink-400'}`}></div>
                                                <div className="truncate">
                                                    <p className="font-medium text-slate-800 truncate">{child.name}</p>
                                                    <p className="text-xs text-slate-500">{new Date(child.birthDate).toLocaleDateString('fr-FR')}</p>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-1">
                                                <button 
                                                    onClick={() => startEdit(child)}
                                                    className="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors"
                                                >
                                                    <Edit2 size={18} />
                                                </button>
                                                <button 
                                                    onClick={() => deleteChild(child.id)}
                                                    className="p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors"
                                                >
                                                    <Trash2 size={18} />
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<TehillimApp />);
    </script>
</body>
</html>
